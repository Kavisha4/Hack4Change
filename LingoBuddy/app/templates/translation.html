<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Translation</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/translation.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Video Translation</h1>
    <form id="translation-form" action="/video_translation" method="post">
        <label for="youtube_url">YouTube URL:</label>
        <input type="text" id="youtube_url" name="youtube_url" required>
        <button type="submit">Translate</button>
    </form>
    <div id="progress" style="display:none;">
        <p>Processing...</p>
        <div class="progress-bar">
            <div class="progress"></div>
        </div>
    </div>
    <div id="result" style="display:none;">
        <h2>Translation Complete</h2>
        <video id="translated-video" controls>
            <!-- Hardcoded path to the video in the static folder -->
            <source src={{ url_for('static', filename='videos/translated_video/translated_video.mp4') }} type="video/mp4">
            Your browser does not support the video tag.
        </video>
        <h3>Translated Text:</h3>
        <p id="translated-text"></p>
        <a id="download-transcription" href="/static/transcription/transcription.txt" download>Download Transcription</a>
    </div>

    <script>
        $(document).ready(function() {
            $('#translation-form').on('submit', function(event) {
                event.preventDefault();
                $('#progress').show();
                $('.progress').css('width', '0%');
                const youtube_url = $('#youtube_url').val();
                
                // Start progress bar animation
                let progress = 0;
                const interval = setInterval(function() {
                    if (progress < 100) {
                        progress += 2; 
                        $('.progress').css('width', progress + '%');
                    }
                }, 500);
                
                $.post('/video_translation', { youtube_url: youtube_url })
                    .done(function() {
                        $('#progress').hide();
                        $('#result').show();
                        clearInterval(interval); 
                        $('#translated-text').text(data.translated_text);
                    })
                    .fail(function() {
                        alert('An error occurred. Please try again.');
                        $('#progress').hide();
                        clearInterval(interval); 
                    });
            });
        });
    </script>
</body>
</html>
